{"data":{"site":{"siteMetadata":{"title":"MaxFun","author":"maxfang"}},"markdownRemark":{"id":"cbca3b70-d29d-5b48-a4c3-df7ec79c8e67","excerpt":"我們今天來談談在JavaScript裡面跟其他語言很不一樣的東西 ，為什麼會想要寫這一篇呢？其實就算不懂 prototypal 你一樣可以做開發，現在很多的框架或是ES6都已經包裝越來越好了，但如果你要成為一位資深的工程師，prototypal…","html":"<p><img src=\"https://i.ytimg.com/vi/MLsg-jv2D08/maxresdefault.jpg\" alt=\"javascript prototype\"></p>\n<center><small>Understand JavaScript Prototypes</small></center>\n<br>\n<p>我們今天來談談在JavaScript裡面跟其他語言很不一樣的東西<code class=\"language-text\">prototypal</code>，為什麼會想要寫這一篇呢？其實就算不懂 prototypal 你一樣可以做開發，現在很多的框架或是ES6都已經包裝越來越好了，但如果你要成為一位資深的工程師，prototypal 你就必須要了解，就像每個家庭主婦都會煮菜，但不是每個家庭主婦都是大廚，如果你要成為一位大廚，就不能只會炒菜跟煮飯(好像扯太遠了XD)。</p>\n<p>再講prototypal之前，先來說說物件，在JavaScript裡面物件是個很重要的東西，如果用得好可以幫你省去很多工，如果用不好，那將會是一場災難。</p>\n<p>首先我們用最簡單的方式創立一個物件，並且給予一些我們想要屬性。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">let</span> hero <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    hero<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'IRON MAN'</span>\n    hero<span class=\"token punctuation\">.</span>power <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n    hero<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">attack</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is attacking.`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    hero<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">jump</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is jumping`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    hero<span class=\"token punctuation\">.</span><span class=\"token function\">attack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// IRON MAN is attacking</span></code></pre></div>\n<p>恭喜你！我們有了一個鋼鐵人出來，世界獲得了短暫的和平，A few years later…，黑暗勢力慢慢崛起，我們發現只有一隻鋼鐵人沒有辦法守護世界的和平，我們需要一個組成一個守護者聯盟，我們把英雄共同的行為部分給抽出來，並用<code class=\"language-text\">function</code>的包裝，我們就可以很快的產生出很多不一樣的英雄。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">function</span> <span class=\"token function\">Hero</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span>power<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> hero <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        hero<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n        hero<span class=\"token punctuation\">.</span>power <span class=\"token operator\">=</span> power\n        hero<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">attack</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is attacking.`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        hero<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">jump</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is jumping`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> hero\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> IronMan <span class=\"token operator\">=</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IronMan'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> BlackPanther <span class=\"token operator\">=</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BlackPanther'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>But…</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    IronMan<span class=\"token punctuation\">.</span>attack <span class=\"token operator\">===</span> BlackPanther<span class=\"token punctuation\">.</span>attack <span class=\"token comment\">// false 都是獨立的記憶體位置</span></code></pre></div>\n<p>Oh!這似乎不是我們所想要的，為什麼呢？我們知道這些英雄的行為都是動態，並且完全通用的，這代表我們不需要每次再重新建立的時候，都還要創建一個新的 method，如果我們今天創建了100個英雄角色，那麼這100個英雄角色都會包含這些methods在裡面，這樣會占據相當多的記憶體，我們只需要讓每個 hero 都去 reference 同一個物件就好。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">const</span> heroMethods <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">attack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is attacking.`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">jump</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is jumping`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// If I add fly method,</span>\n        <span class=\"token comment\">// fly(){</span>\n        <span class=\"token comment\">//     console.log(`${this.name} is flying`)</span>\n        <span class=\"token comment\">// }</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">Hero</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span>power<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> hero <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        hero<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n        hero<span class=\"token punctuation\">.</span>power <span class=\"token operator\">=</span> power\n        hero<span class=\"token punctuation\">.</span>attack <span class=\"token operator\">=</span> heroMethods<span class=\"token punctuation\">.</span>attack\n        hero<span class=\"token punctuation\">.</span>jump <span class=\"token operator\">=</span> heroMethods<span class=\"token punctuation\">.</span>jump\n        <span class=\"token comment\">// I also have to adding this line </span>\n        hero<span class=\"token punctuation\">.</span>fly <span class=\"token operator\">=</span> heroMethods<span class=\"token punctuation\">.</span>fly\n        <span class=\"token keyword\">return</span> hero\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> IronMan <span class=\"token operator\">=</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IronMan'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> BlackPanther <span class=\"token operator\">=</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BlackPanther'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n    IronMan<span class=\"token punctuation\">.</span>attack <span class=\"token operator\">===</span> BlackPanther<span class=\"token punctuation\">.</span>attack <span class=\"token comment\">// true 都共用同一個記憶體位置</span></code></pre></div>\n<h3>Object.create</h3>\n<blockquote>\n<p>Object.create allows you to create an object which will delegate to another object on failed lookups</p>\n</blockquote>\n<p>看起來還不錯，但有個問題，例如當我們要再為 Hero 增加新的飛行技能的時候，就要在 Hero 那邊再加一行<code class=\"language-text\">hero.fly = heroMethods.fly</code>上去，這樣顯得不是很方便，如果我們可以把這些屬性加到物件的原型上，這樣物件彼此之間就可以互相共用了，而<code class=\"language-text\">Object.create</code> 幫我們解決了這個問題，他幫我們建立一個新的物件，並把屬性繼承到新的物件原型上，然後返回給我們，我們再用 Object.create 來改寫看看。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">const</span> heroMethods <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">attack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is attacking.`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">jump</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is jumping`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">Hero</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span>power<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> hero <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>heroMethods<span class=\"token punctuation\">)</span>\n        hero<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n        hero<span class=\"token punctuation\">.</span>power <span class=\"token operator\">=</span> power\n        <span class=\"token keyword\">return</span> hero\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> IronMan <span class=\"token operator\">=</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IronMan'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> BlackPanther <span class=\"token operator\">=</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BlackPanther'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Prototypal Instantiation</h3>\n<p>Ｗow～我們這下可以拍復仇者聯盟無限續集了，但還是有一些地方可以做改進的，我們要去維護一個”heroMethods”聽起來有點奇怪，既然 JavaScript 屬於 prototype based 的語言，我們就用 prototypal inheritance 的方式，去繼承我們要的物件似乎更理想囉。</p>\n<p><strong>prototype and __proto__</strong></p>\n<ul>\n<li>__proto__ : 每個物件都有自己的 __proto__ ，當前找不到屬性的話就會往下一層的 __proto__ 去找，直到找到最後null為止，而這樣從物件本身往 proto 尋找下去的鍊我們就稱作「原型鍊（prototype chain）」</li>\n<li>prototype: 在 JavaScript 裡面每個 function 都有 prototype 這個物件屬性, 當使用 new 這個 operator 的時候，就會會去參照 prototype，並建立原型鍊。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">function</span> <span class=\"token function\">Hero</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span>power<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> hero <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>Hero<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span>\n        hero<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n        hero<span class=\"token punctuation\">.</span>power <span class=\"token operator\">=</span> power\n        <span class=\"token keyword\">return</span> hero\n    <span class=\"token punctuation\">}</span>\n    Hero<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">attack</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is attacking.`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    Hero<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">jump</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is jumping`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> IronMan <span class=\"token operator\">=</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IronMan'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> BlackPanther <span class=\"token operator\">=</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BlackPanther'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/maxfun.io/static/d934a96151f4ad293e28f891bf27019d/15038/object-create-proto.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.86585365853659%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABi0lEQVQoz4WSj5KaMBCHff/X6guc7WhpD5SpgB5ECZCEgMDXBfXOm+n0MrOzm3/f/jab1aXUpNmJn8Erbet5jOnJePJ8OnHz0zQyjrOfWBVKEe12HLIUXWmqqsJ1PWPbMhjDVfb9MWPwnlZMay2JLc4OHFOHNj3X8SPNqmlqwt8haZiSJUe2P9bkcUS731OvXyi/r7FBQO8sSuB7WVcqp9I9u9cKVXn64aFUFM7haEb+fEtQ+zO9lK2CFBeFWFHejyNfjxl2VzhK/XVRcwlLLgLUF08cD5+Pz9DppmCUeHqPp3v8pHAYBqyxNKeGKqmpDzVO1xjb4VvHvD9feED+ZQvuDl5K7q8deVSQbxRvQU5+rMnPDYUqbuq+Knj6+AMLsOs7yrTk9PKGPlWU8uBFljPIa/dXMFKBMY2Yuf0C57DWLnPv/ZPCe1PmxaY0WCUHC4dTFl+KaoFmx5LtNiCKIpIkYbPZLJ0OpPNhGC4JnlW+A50R0NnR5AIW3/mOQ3Lgl1yM43hpxv9KfthfOqoFY5uI9jIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Missing new keyword\"\n        title=\"\"\n        src=\"/maxfun.io/static/d934a96151f4ad293e28f891bf27019d/fb8a0/object-create-proto.png\"\n        srcset=\"/maxfun.io/static/d934a96151f4ad293e28f891bf27019d/1a291/object-create-proto.png 148w,\n/maxfun.io/static/d934a96151f4ad293e28f891bf27019d/2bc4a/object-create-proto.png 295w,\n/maxfun.io/static/d934a96151f4ad293e28f891bf27019d/fb8a0/object-create-proto.png 590w,\n/maxfun.io/static/d934a96151f4ad293e28f891bf27019d/15038/object-create-proto.png 656w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n我們把 heroMethods 裡面的屬性加到 prototype 裡面，接著我們用 Object.create 去繼承 Hero.prototype，這樣一來就完成了。</p>\n<p>property 是在 JavaScript 中每個 function 都具有的屬性，讓我們在函數的所有實例化之間共享方法，我們稱這種    pattern 為 <strong>Prototypal Instantiation</strong>。</p>\n<h3>“new” keyword</h3>\n<p>Oh～在 JavaScript 裡面難道就沒有一個更快速且便利，完成上面的那些事情嗎？\n答案是有，就是 new 這個 keyword，我們從上面的寫法可以知道，要創建一個 Hero 有兩個重要的地方:</p>\n<ol>\n<li>創建對象，並把 function’s prototype 委託給新建立的物件。</li>\n<li>回傳建構式物件回去。</li>\n</ol>\n<p>用 new keyword 來改寫上面例子看看</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">function</span> <span class=\"token function\">Hero</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span>power<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>power <span class=\"token operator\">=</span> power\n    <span class=\"token punctuation\">}</span>\n    Hero<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">attack</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is attacking.`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    Hero<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">jump</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is jumping`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> IronMan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IronMan'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> BlackPanther <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BlackPanther'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>啊哈～看出來了嘛，沒錯！new keyword 在後面幫你把上面說的兩點做掉了，我們來看一下 new 實際做了哪些事情，在 MDN 上面列出了幾點:</p>\n<ul>\n<li>Creates a blank, plain JavaScript object(創建一個空的物件)</li>\n<li>Links (sets the constructor of) this object to another object(鏈結其他的物件，並給予constructor屬性)</li>\n<li>Passes the newly created object from Step 1 as the this context(把創建的新物件綁定 this)</li>\n<li>Returns this if the function doesn’t return its own object(如果函式沒有回傳自己的物件，則回傳this)</li>\n</ul>\n<p>那如果我們不小心忘了在前面加<strong>new</strong>呢？\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/maxfun.io/static/6bbe22586812eee374645523ec93f0ee/edd88/missing-new-keyword.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 66.37744034707158%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2UlEQVQ4y42TiW7bMBBE/f/fFhQoigTxJdmyTusiJVK39LpyCgNunaQLDJYEpeHsznIzjiM2qrGepvQr/LAmzw2HgyIIapKkwRjDPM0sy/ItNrfFOFO/FUS/Ql5+vpLFMT9eUrZbzSBn8zJzjz8/rvlZbKZpotSavu2pdY3SirZt0bWlbloQwsVOjHakG0amvwj+UXgjLBXexWd3cDg6J/ZHl2R/JD9EpF6C9+rSuAna9TDnM/3lQq+U3DXfSe8K1x5e0+xGGsdXkmtKlhfkcUJf1tShpgpLTKborGGyDXMjGIZ76Q+Es9xiuoYoveIHF8I4wAsCyrNHF1YUgSJ0Y9q0YMhTOs+TnDM9UXcnrI4Fjbh5dCt2O02eagI/Ihe12nWpdu90ojo4ZFKqZup7hmElXPgQ+aBwodznKF9zvjScXIPvWxkdS6UKcfxKJ4pXZebkM0slg+1QanggvJsyjhO2lz7mGWl2RVeKUpUCJb0sKURRJD22nZCYmkB6W8jZPE/PS15dNsbeYGVMuq6nkbFphaC7QfZiwiAmrPtGTFnz2qqng71+GIYRjuNireV/49OXso5NKGUESYIfxR/DLPGZgm+f3qowdRzStzey9y1K1qO4+JWKr/AbjQfuhhu9QecAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Missing new keyword\"\n        title=\"\"\n        src=\"/maxfun.io/static/6bbe22586812eee374645523ec93f0ee/fb8a0/missing-new-keyword.png\"\n        srcset=\"/maxfun.io/static/6bbe22586812eee374645523ec93f0ee/1a291/missing-new-keyword.png 148w,\n/maxfun.io/static/6bbe22586812eee374645523ec93f0ee/2bc4a/missing-new-keyword.png 295w,\n/maxfun.io/static/6bbe22586812eee374645523ec93f0ee/fb8a0/missing-new-keyword.png 590w,\n/maxfun.io/static/6bbe22586812eee374645523ec93f0ee/526de/missing-new-keyword.png 885w,\n/maxfun.io/static/6bbe22586812eee374645523ec93f0ee/edd88/missing-new-keyword.png 922w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Oh my god! “IronMan” 變成 undefined，還有一個荒唐的錯誤，name 變成在 global object 底下了，而且不會跳出任何的錯誤訊息，這對於我們開發者來說其實不是很 friendly。<br>但不會擔心，社會在走，JavaScript 更新每年都會有，在 ECMAScript 6 中引入了類別 (class) 。</p>\n<h3>Class</h3>\n<blockquote>\n<p>JavaScript classes, introduced in ECMAScript 2015, are primarily syntactical sugar over JavaScript’s existing prototype-based inheritance. The class syntax does not introduce a new object-oriented inheritance model to JavaScript.</p>\n</blockquote>\n<p>在 ECMAScript 6 中新增的 class 只是個 syntactical sugar(語法糖)，與其他OOP語言不太一樣，底層還是實作 prototype-based，我們來試試用 Class 改寫看看吧。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Hero</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span>power<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>power <span class=\"token operator\">=</span> power\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">attack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is attacking.`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">jump</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is jumping`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> IronMan <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IronMan'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> BlackPanther <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BlackPanther'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>是不是覺得很熟悉啊！是不是跟其他語言的寫法有87分像呢，class 寫法也讓我們寫起來更加簡潔。</p>\n<p>喔～那如果我們也一樣小心忘了在前面加<strong>new</strong>呢？\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/maxfun.io/static/68b920a4a42edf45bbb99718fca9aaf3/448c3/class-missing-new-keyword.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 41.904761904761905%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABOklEQVQoz32Ra0/jMBBF+/9/G1qqRYKUNKVfSNO8aidu4vh1mKDtqgjBSFceje2j6+uNtw57NuTPJW/Hmq7raBpDXU+07Yy1lpQSa63rvW6z+9rcmmWxjEVPnh0oDkf2rx3ZThFj+Ab6CfYfGELgclGY3qB6/Ql3i8cY9/X0HeBXhzFGlNK8VxV106L0wNT3hGZEX0b6piGOI65tWcoSJ7GsJn4FnqqzZNehh4HrNGFHg9czk5kxMouzJQjUK0VYFtI/x5/AO21kRBRNAtFaydMvaIHNctF1E8M4Swwdabri6hp7Kgne/5zhIg6m04DRjvfSSm6LuNQYgbpzRagr6T3j4L9keXP2zaE7vBF2e8LDH+zfZ/zjFr/dEl4y4qqnJ3xeEOTn2e9JxyOpKED20u6VlOewKsuQzPgAKzJri/eIlmkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Missing new keyword\"\n        title=\"\"\n        src=\"/maxfun.io/static/68b920a4a42edf45bbb99718fca9aaf3/fb8a0/class-missing-new-keyword.png\"\n        srcset=\"/maxfun.io/static/68b920a4a42edf45bbb99718fca9aaf3/1a291/class-missing-new-keyword.png 148w,\n/maxfun.io/static/68b920a4a42edf45bbb99718fca9aaf3/2bc4a/class-missing-new-keyword.png 295w,\n/maxfun.io/static/68b920a4a42edf45bbb99718fca9aaf3/fb8a0/class-missing-new-keyword.png 590w,\n/maxfun.io/static/68b920a4a42edf45bbb99718fca9aaf3/526de/class-missing-new-keyword.png 885w,\n/maxfun.io/static/68b920a4a42edf45bbb99718fca9aaf3/448c3/class-missing-new-keyword.png 1050w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n是不是很棒呢！</p>\n<h3>Arrow Functions</h3>\n<p>在 ECMAScript 6 中所新增的 arrow function 並沒有自己的 this 在裡面，換言之 arrow function 並不能成為建構式函數，如果我們用試著去 new 一個 arrow function，那麼會跳出錯誤。</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/maxfun.io/static/788ae704d487f330d4e725bc96b6b647/45fcc/arrow-function-new.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 23.7467018469657%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5klEQVQY03WQ606DQBCF9/1fSZP+0mhDCxZE2iCmSFChsEDthULnc7HxFnWTLzk5c/ZMMqqJKtbzgjR5xQ9q9KpmVZZsqpI8TclLTdf39McjAidEvvR3jK+au4y190zxYgrdHM/JqArNLsnQ/hOPcUwcPbCpazDFst9D18HhAG37E+Or9j6EiQWjEVhjsKdwdg5X1+B54LowNv5igYQhMnORKEJ8H5naiHeL2A4yzM1S1Q+bl0skmJvwDLEmyMUl4twYLzh9TBKkaRCtkaqCAaPf+dBDj8mo3XYLf93jF/KZ+/eZG74Byih9NCZr6YEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"arrow function with new keyword\"\n        title=\"\"\n        src=\"/maxfun.io/static/788ae704d487f330d4e725bc96b6b647/fb8a0/arrow-function-new.png\"\n        srcset=\"/maxfun.io/static/788ae704d487f330d4e725bc96b6b647/1a291/arrow-function-new.png 148w,\n/maxfun.io/static/788ae704d487f330d4e725bc96b6b647/2bc4a/arrow-function-new.png 295w,\n/maxfun.io/static/788ae704d487f330d4e725bc96b6b647/fb8a0/arrow-function-new.png 590w,\n/maxfun.io/static/788ae704d487f330d4e725bc96b6b647/45fcc/arrow-function-new.png 758w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>既然箭頭函示不能成為 constructor functions，那麼 prototype 也一樣會是 undefined。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Hero</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    Hero<span class=\"token punctuation\">.</span>prototype <span class=\"token comment\">//undefined</span></code></pre></div>\n<!-- // Object.create\nObject.create = function(o){\n    var F = function(){}; // 隐式构造函数\n    F.prototype = o;\n    return new F(); // 返回一个new\n} -->\n<!-- // new 详细内核\nfunction objectFactory() {\n    var args = Array.prototype.slice.call(arguments) // 使用objectFactory的时候,把arguments,转化为数组\n    var Constructor = args.shift() //提取第1个构建对象\n    var instance = Object.create(Constructor.prototype) // 创建constructor实例 instance ,等同于上面的 new Object() 和 o1.__proto = Base.prototype\n    var temp = Constructor.apply(instance, args)  // 使用apply函数运行args, 把 instance 绑定到 this ,等同于上面的Base.call(o1)\n    return (typeof temp === 'object' && temp !== null) ? temp : instance  //返回对象判断 是object 还是 null 还是实例\n} -->\n<p><strong>資料來源:</strong><br>\n<small>\n<a href=\"https://medium.freecodecamp.org/a-beginners-guide-to-javascript-s-prototype-9c049fe7b34\">- A Beginner’s Guide to JavaScript’s Prototype</a>\n</small>\n<br>\n<small>\n<a href=\"https://medium.com/@parsyval/javascript-prototype-vs-class-a7015d5473b\">- Javascript : Prototype vs Class</a>\n</small>\n<br>\n<small>\n<a href=\"https://medium.com/@jonathanvox01/understanding-the-difference-between-object-create-and-the-new-operator-b2a2f4749358\">- Understanding the difference between Object.create() and the new operator.</a>\n</small></p>","frontmatter":{"title":"JavaScript -- \"prototypal\"","date":"February 05, 2019","image":"https://i.ytimg.com/vi/MLsg-jv2D08/maxresdefault.jpg"}}},"pageContext":{"slug":"/javaScript-prototypal/","previous":{"fields":{"slug":"/top-javaScript-frameworks-and-topic/"},"frontmatter":{"title":"2019 最受矚目的 JavaScript 框架與技術學習"}},"next":null}}